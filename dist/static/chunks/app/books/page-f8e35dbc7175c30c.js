(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{283:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,AuthProvider:()=>i});var a=r(5155),s=r(2115),o=r(2099);let l=(0,s.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,s.useState)(null),[n,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{o.N.auth.getSession().then(e=>{let{data:{session:t}}=e;(null==t?void 0:t.user)?d(t.user.id):(i(null),c(!1))});let{data:{subscription:e}}=o.N.auth.onAuthStateChange((e,t)=>{(null==t?void 0:t.user)?d(t.user.id):(i(null),c(!1))});return()=>{e.unsubscribe()}},[]);let d=async e=>{try{let{data:t,error:r}=await o.N.from("profiles").select("*").eq("id",e).single();if(r)throw r;i(t)}catch(e){console.error("Error fetching user profile:",e),i(null)}finally{c(!1)}},u=async(e,t)=>{let{error:r}=await o.N.auth.signInWithPassword({email:e,password:t});if(r)throw r},g=async(e,t)=>{let{data:r,error:a}=await o.N.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(a)throw a;if(r.user){let{error:e}=await o.N.from("profiles").insert([{id:r.user.id,email:r.user.email,full_name:"",phone_number:"",location:""}]);if(e)throw e}},h=async()=>{let{error:e}=await o.N.auth.signOut();if(e)throw e},m=async e=>{if(!r)throw Error("No user logged in");let{error:t}=await o.N.from("profiles").update(e).eq("id",r.id);if(t)throw t;i(t=>t?{...t,...e}:null)};return(0,a.jsx)(l.Provider,{value:{user:r,loading:n,signIn:u,signUp:g,signOut:h,updateProfile:m},children:t})}function n(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2099:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});let a=(0,r(851).UU)("https://apbgdwgiqrzarwnicguu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwYmdkd2dpcXJ6YXJ3bmljZ3V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczOTYzMDgsImV4cCI6MjA2Mjk3MjMwOH0.jrWCdt10IvmdK5FJolNYUFAMBZAttwTqycgGXRj6Isw")},5533:(e,t,r)=>{Promise.resolve().then(r.bind(r,6593))},6593:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(5155),s=r(2115),o=r(5695),l=r(283),i=r(9207),n=r(6874),c=r.n(n),d=r(8046);function u(e){let{category:t,onSearch:r,initialQuery:l=""}=e,[i,n]=(0,s.useState)(l);(0,o.useRouter)();let c=(0,o.useSearchParams)();return(0,s.useEffect)(()=>{let e=c.get("q");e&&n(e)},[c]),(0,s.useEffect)(()=>{n(l)},[l]),(0,a.jsx)("div",{className:"w-full max-w-2xl",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:i,onChange:e=>{let t=e.target.value;n(t),r(t)},placeholder:"Search books by title, author, or ISBN...",className:"w-full px-4 py-2 pl-10 text-gray-900 dark:text-white bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"}),(0,a.jsx)(d.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"})]})})}var g=r(1934);function h(){let[e,t]=(0,s.useState)([]),[r,n]=(0,s.useState)(!0),[d,h]=(0,s.useState)(""),[m,b]=(0,s.useState)("");(0,o.useRouter)();let f=(0,o.useSearchParams)(),{user:x}=(0,l.A)(),p=f.get("category"),y=async e=>{try{n(!0);let r=new URLSearchParams;e&&r.set("q",e),p&&r.set("category",p);let a=await (0,i.zy)(r);t(a)}catch(e){console.error("Error fetching books:",e),h("Failed to load books. Please try again later.")}finally{n(!1)}};return(0,s.useEffect)(()=>{let e=f.get("q");e&&b(e),y(e||void 0)},[p]),(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-12",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:p?"".concat(p.charAt(0).toUpperCase()).concat(p.slice(1)," Books"):"Available Books"}),x&&(0,a.jsx)(c(),{href:"/sell",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",children:"Sell a Book"})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(u,{category:p||void 0,onSearch:e=>{b(e),y(e)},initialQuery:m})}),d?(0,a.jsx)("div",{className:"text-center text-red-600 dark:text-red-400",children:d}):(0,a.jsxs)("div",{className:"relative",children:[r&&(0,a.jsx)("div",{className:"absolute inset-0 bg-white/50 dark:bg-gray-900/50 backdrop-blur-sm z-10 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}),0===e.length?(0,a.jsx)("div",{className:"text-center py-12",children:p?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("p",{className:"text-gray-500 dark:text-gray-400 text-lg",children:["No books available in the ",p," category at the moment."]}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Would you like to browse all available books instead?"}),(0,a.jsx)(c(),{href:"/books",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",children:"Browse All Books"})]}):(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No books available at the moment."})}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:e.map(e=>(0,a.jsx)(g.P.div,{whileHover:{y:-5},className:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-md rounded-lg shadow-lg",children:(0,a.jsxs)(c(),{href:"/books/".concat(e.id),children:[(0,a.jsx)("div",{className:"aspect-[4/3] relative overflow-hidden rounded-t-lg",children:e.images&&e.images.length>0?(0,a.jsx)("img",{src:e.images[0],alt:e.title,className:"w-full h-full object-cover transition-transform duration-300 hover:scale-110"}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"No image"})})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2 line-clamp-1",children:e.author}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:["â‚¹",e.price]}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat("available"===e.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200"),children:e.status})]})]})]})},e.id))})]})]})})})}function m(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}),children:(0,a.jsx)(h,{})})}},8046:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(2115);let s=a.forwardRef(function(e,t){let{title:r,titleId:s,...o}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},o),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))})},9207:(e,t,r)=>{"use strict";r.d(t,{QY:()=>o,bp:()=>s,r3:()=>l,zy:()=>i});var a=r(2099);let s=async(e,t)=>{try{let r=[];for(let s of e.images){let e=s.name.split(".").pop(),o="".concat(Math.random(),".").concat(e),l="".concat(t,"/").concat(o),{error:i}=await a.N.storage.from("book-images").upload(l,s);if(i)throw i;let{data:{publicUrl:n}}=a.N.storage.from("book-images").getPublicUrl(l);r.push(n)}let{data:s,error:o}=await a.N.from("books").insert([{title:e.title,author:e.author,description:e.description,price:e.price,condition:e.condition,year_of_publication:e.yearOfPublication,location:e.location,category:e.category,tags:e.tags,images:r,seller_id:t,status:"available",created_at:new Date().toISOString()}]).select().single();if(o)throw o;return s}catch(e){throw console.error("Error in addBook:",e),e}},o=async e=>{console.log("Fetching book with ID:",e);try{let{data:t,error:r}=await a.N.from("books").select("\n        *,\n        seller:profiles!books_seller_id_fkey (\n          id,\n          email,\n          full_name,\n          location,\n          phone_number,\n          avatar_url\n        )\n      ").eq("id",e).single();if(r)throw console.error("Supabase error:",r),r;if(!t)throw console.error("No book found with ID:",e),Error("Book not found");return console.log("Book data:",t),t}catch(e){throw console.error("Error in getBook:",e),e}},l=async(e,t)=>{console.log("Updating book with data:",t);let{images:r,existingImages:s,yearOfPublication:o,...l}=t,i={...l,year_of_publication:o};if(r&&r.length>0){let{data:{user:e}}=await a.N.auth.getUser();if(!e)throw Error("User must be authenticated to update book images");let t=[];for(let s of r){let r=s.name.split(".").pop(),o="".concat(Math.random(),".").concat(r),l="".concat(e.id,"/").concat(o),{error:i}=await a.N.storage.from("book-images").upload(l,s);if(i)throw i;let{data:{publicUrl:n}}=a.N.storage.from("book-images").getPublicUrl(l);t.push(n)}i.images=[...s||[],...t]}let{data:n,error:c}=await a.N.from("books").update(i).eq("id",e).select().single();if(c)throw console.error("Error updating book:",c),c;return n};async function i(e){try{let t=a.N.from("books").select("*").order("created_at",{ascending:!1}),r=null==e?void 0:e.get("q");r&&(t=t.or("title.ilike.%".concat(r,"%,author.ilike.%").concat(r,"%,description.ilike.%").concat(r,"%")));let s=null==e?void 0:e.get("category");s&&(t=t.eq("category",s));let{data:o,error:l}=await t;if(l)throw l;return o||[]}catch(e){throw console.error("Error fetching books:",e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,874,628,441,684,358],()=>t(5533)),_N_E=e.O()}]);