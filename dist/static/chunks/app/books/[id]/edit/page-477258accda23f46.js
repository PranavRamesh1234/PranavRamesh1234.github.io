(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[44],{2099:(e,t,a)=>{"use strict";a.d(t,{N:()=>r});let r=(0,a(851).UU)("https://apbgdwgiqrzarwnicguu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwYmdkd2dpcXJ6YXJ3bmljZ3V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczOTYzMDgsImV4cCI6MjA2Mjk3MjMwOH0.jrWCdt10IvmdK5FJolNYUFAMBZAttwTqycgGXRj6Isw")},4526:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var r=a(5155),o=a(2115),l=a(5695),i=a(9207),s=a(2099);let n=[{value:"new",label:"New"},{value:"like-new",label:"Like New"},{value:"good",label:"Good"},{value:"fair",label:"Fair"},{value:"poor",label:"Poor"}],c=[{value:"academic",label:"Academic"},{value:"fiction",label:"Fiction"},{value:"non-fiction",label:"Non-Fiction"},{value:"textbook",label:"Textbook"},{value:"reference",label:"Reference"},{value:"other",label:"Other"}];function d(e){let{params:t}=e,a=(0,l.useRouter)(),[d,u]=(0,o.useState)(!0),[m,b]=(0,o.useState)(!1),[g,p]=(0,o.useState)([]),[h,f]=(0,o.useState)({title:"",author:"",description:"",price:0,condition:"new",images:[],yearOfPublication:new Date().getFullYear(),location:"",category:"other",tags:[]});(0,o.useEffect)(()=>{(async()=>{try{let{data:e,error:a}=await s.N.from("books").select("*").eq("id",t.id).single();if(a)throw a;if(!e)throw Error("Book not found");f({title:e.title,author:e.author,description:e.description,price:e.price,condition:e.condition,images:[],yearOfPublication:e.year_of_publication,location:e.location,category:e.category,tags:e.tags||[]}),p(e.images||[])}catch(e){console.error("Error fetching book:",e),a.push("/profile")}finally{u(!1)}})()},[t.id,a]);let x=async e=>{e.preventDefault();try{b(!0),console.log("Updating book with data:",{...h,existingImages:g}),await (0,i.r3)(t.id,{...h,condition:h.condition,existingImages:g}),console.log("Book updated successfully"),a.push("/profile")}catch(e){console.error("Error updating book:",e),alert("Failed to update book. Please try again.")}finally{b(!1)}},y=e=>{f(t=>({...t,images:t.images.filter((t,a)=>a!==e)}))},v=e=>{p(t=>t.filter((t,a)=>a!==e))};return d?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Edit Book"}),(0,r.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),(0,r.jsx)("input",{type:"text",value:h.title,onChange:e=>f(t=>({...t,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Author"}),(0,r.jsx)("input",{type:"text",value:h.author,onChange:e=>f(t=>({...t,author:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,r.jsx)("textarea",{value:h.description,onChange:e=>f(t=>({...t,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:4,required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price"}),(0,r.jsx)("input",{type:"number",value:h.price,onChange:e=>f(t=>({...t,price:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"0",step:"0.01",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Condition"}),(0,r.jsx)("select",{value:h.condition,onChange:e=>f(t=>({...t,condition:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:n.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year of Publication"}),(0,r.jsx)("input",{type:"number",value:h.yearOfPublication,onChange:e=>f(t=>({...t,yearOfPublication:parseInt(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"1900",max:new Date().getFullYear(),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),(0,r.jsx)("input",{type:"text",value:h.location,onChange:e=>f(t=>({...t,location:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,r.jsx)("select",{value:h.category,onChange:e=>f(t=>({...t,category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:c.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma-separated)"}),(0,r.jsx)("input",{type:"text",value:Array.isArray(h.tags)?h.tags.join(", "):h.tags,onChange:e=>f(t=>({...t,tags:e.target.value.split(",").map(e=>e.trim())})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"e.g. mystery, thriller, fiction"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Images"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[g.map((e,t)=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:e,alt:"Book ".concat(t+1),className:"w-full h-32 object-cover rounded-lg"}),(0,r.jsx)("button",{type:"button",onClick:()=>v(t),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t)),h.images.map((e,t)=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:URL.createObjectURL(e),alt:"New image ".concat(t+1),className:"w-full h-32 object-cover rounded-lg"}),(0,r.jsx)("button",{type:"button",onClick:()=>y(t),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t))]}),(0,r.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{if(e.target.files){let t=Array.from(e.target.files);f(e=>({...e,images:[...e.images,...t]}))}},className:"block w-full text-sm text-gray-500   file:mr-4 file:py-2 file:px-4   file:rounded-full file:border-0   file:text-sm file:font-semibold   file:bg-blue-50 file:text-blue-700   hover:file:bg-blue-100"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>a.push("/profile"),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:m?"Saving...":"Save Changes"})]})]})]})}},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},5832:(e,t,a)=>{Promise.resolve().then(a.bind(a,4526))},9207:(e,t,a)=>{"use strict";a.d(t,{QY:()=>l,bp:()=>o,r3:()=>i,zy:()=>s});var r=a(2099);let o=async(e,t)=>{try{let a=[];for(let o of e.images){let e=o.name.split(".").pop(),l="".concat(Math.random(),".").concat(e),i="".concat(t,"/").concat(l),{error:s}=await r.N.storage.from("book-images").upload(i,o);if(s)throw s;let{data:{publicUrl:n}}=r.N.storage.from("book-images").getPublicUrl(i);a.push(n)}let{data:o,error:l}=await r.N.from("books").insert([{title:e.title,author:e.author,description:e.description,price:e.price,condition:e.condition,year_of_publication:e.yearOfPublication,location:e.location,category:e.category,tags:e.tags,images:a,seller_id:t,status:"available",created_at:new Date().toISOString()}]).select().single();if(l)throw l;return o}catch(e){throw console.error("Error in addBook:",e),e}},l=async e=>{console.log("Fetching book with ID:",e);try{let{data:t,error:a}=await r.N.from("books").select("\n        *,\n        seller:profiles!books_seller_id_fkey (\n          id,\n          email,\n          full_name,\n          location,\n          phone_number,\n          avatar_url\n        )\n      ").eq("id",e).single();if(a)throw console.error("Supabase error:",a),a;if(!t)throw console.error("No book found with ID:",e),Error("Book not found");return console.log("Book data:",t),t}catch(e){throw console.error("Error in getBook:",e),e}},i=async(e,t)=>{console.log("Updating book with data:",t);let{images:a,existingImages:o,yearOfPublication:l,...i}=t,s={...i,year_of_publication:l};if(a&&a.length>0){let{data:{user:e}}=await r.N.auth.getUser();if(!e)throw Error("User must be authenticated to update book images");let t=[];for(let o of a){let a=o.name.split(".").pop(),l="".concat(Math.random(),".").concat(a),i="".concat(e.id,"/").concat(l),{error:s}=await r.N.storage.from("book-images").upload(i,o);if(s)throw s;let{data:{publicUrl:n}}=r.N.storage.from("book-images").getPublicUrl(i);t.push(n)}s.images=[...o||[],...t]}let{data:n,error:c}=await r.N.from("books").update(s).eq("id",e).select().single();if(c)throw console.error("Error updating book:",c),c;return n};async function s(e){try{let t=r.N.from("books").select("*").order("created_at",{ascending:!1}),a=null==e?void 0:e.get("q");a&&(t=t.or("title.ilike.%".concat(a,"%,author.ilike.%").concat(a,"%,description.ilike.%").concat(a,"%")));let o=null==e?void 0:e.get("category");o&&(t=t.eq("category",o));let{data:l,error:i}=await t;if(i)throw i;return l||[]}catch(e){throw console.error("Error fetching books:",e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,441,684,358],()=>t(5832)),_N_E=e.O()}]);