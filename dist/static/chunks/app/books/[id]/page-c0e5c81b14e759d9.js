(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{934:(e,t,r)=>{Promise.resolve().then(r.bind(r,9672))},2099:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});let a=(0,r(851).UU)("https://apbgdwgiqrzarwnicguu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwYmdkd2dpcXJ6YXJ3bmljZ3V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczOTYzMDgsImV4cCI6MjA2Mjk3MjMwOH0.jrWCdt10IvmdK5FJolNYUFAMBZAttwTqycgGXRj6Isw")},8046:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(2115);let l=a.forwardRef(function(e,t){let{title:r,titleId:l,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},s),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))})},9207:(e,t,r)=>{"use strict";r.d(t,{QY:()=>s,bp:()=>l,r3:()=>o,zy:()=>i});var a=r(2099);let l=async(e,t)=>{try{let r=[];for(let l of e.images){let e=l.name.split(".").pop(),s="".concat(Math.random(),".").concat(e),o="".concat(t,"/").concat(s),{error:i}=await a.N.storage.from("book-images").upload(o,l);if(i)throw i;let{data:{publicUrl:n}}=a.N.storage.from("book-images").getPublicUrl(o);r.push(n)}let{data:l,error:s}=await a.N.from("books").insert([{title:e.title,author:e.author,description:e.description,price:e.price,condition:e.condition,year_of_publication:e.yearOfPublication,location:e.location,category:e.category,tags:e.tags,images:r,seller_id:t,status:"available",created_at:new Date().toISOString()}]).select().single();if(s)throw s;return l}catch(e){throw console.error("Error in addBook:",e),e}},s=async e=>{console.log("Fetching book with ID:",e);try{let{data:t,error:r}=await a.N.from("books").select("\n        *,\n        seller:profiles!books_seller_id_fkey (\n          id,\n          email,\n          full_name,\n          location,\n          phone_number,\n          avatar_url\n        )\n      ").eq("id",e).single();if(r)throw console.error("Supabase error:",r),r;if(!t)throw console.error("No book found with ID:",e),Error("Book not found");return console.log("Book data:",t),t}catch(e){throw console.error("Error in getBook:",e),e}},o=async(e,t)=>{console.log("Updating book with data:",t);let{images:r,existingImages:l,yearOfPublication:s,...o}=t,i={...o,year_of_publication:s};if(r&&r.length>0){let{data:{user:e}}=await a.N.auth.getUser();if(!e)throw Error("User must be authenticated to update book images");let t=[];for(let l of r){let r=l.name.split(".").pop(),s="".concat(Math.random(),".").concat(r),o="".concat(e.id,"/").concat(s),{error:i}=await a.N.storage.from("book-images").upload(o,l);if(i)throw i;let{data:{publicUrl:n}}=a.N.storage.from("book-images").getPublicUrl(o);t.push(n)}i.images=[...l||[],...t]}let{data:n,error:c}=await a.N.from("books").update(i).eq("id",e).select().single();if(c)throw console.error("Error updating book:",c),c;return n};async function i(e){try{let t=a.N.from("books").select("*").order("created_at",{ascending:!1}),r=null==e?void 0:e.get("q");r&&(t=t.or("title.ilike.%".concat(r,"%,author.ilike.%").concat(r,"%,description.ilike.%").concat(r,"%")));let l=null==e?void 0:e.get("category");l&&(t=t.eq("category",l));let{data:s,error:o}=await t;if(o)throw o;return s||[]}catch(e){throw console.error("Error fetching books:",e),e}}},9672:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(5155),l=r(2115),s=r(9207),o=r(6766),i=r(6874),n=r.n(i),c=r(8046);let d=l.forwardRef(function(e,t){let{title:r,titleId:a,...s}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},s),r?l.createElement("title",{id:a},r):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}),m=l.forwardRef(function(e,t){let{title:r,titleId:a,...s}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},s),r?l.createElement("title",{id:a},r):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))});function g(e){let{params:t}=e,[r,i]=(0,l.useState)(null),[g,h]=(0,l.useState)(!0),[u,x]=(0,l.useState)(null),[b,f]=(0,l.useState)(0),[k,p]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,s.QY)(t.id);i(e)}catch(e){console.error("Error fetching book:",e),x(e instanceof Error?e.message:"Failed to load book")}finally{h(!1)}})()},[t.id]);let y=e=>{f(e)},j=()=>{p(!k)};return g?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):u||!r?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:u||"Book Not Found"}),(0,a.jsx)(n(),{href:"/books",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"Back to Books"})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-12",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 p-8",children:[(0,a.jsx)("div",{className:"space-y-4",children:r.images&&r.images.length>0?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"relative aspect-[3/4] w-full overflow-hidden rounded-lg",children:[(0,a.jsx)(o.default,{src:r.images[b],alt:r.title,fill:!0,className:"object-cover transition-transform duration-300 cursor-zoom-in ".concat(k?"scale-150":"scale-100"),onClick:j}),(0,a.jsx)("button",{onClick:j,className:"absolute bottom-4 right-4 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:(0,a.jsx)(c.A,{className:"h-6 w-6"})})]}),r.images.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{(null==r?void 0:r.images)&&f(e=>0===e?r.images.length-1:e-1)},className:"absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:(0,a.jsx)(d,{className:"h-6 w-6"})}),(0,a.jsx)("button",{onClick:()=>{(null==r?void 0:r.images)&&f(e=>e===r.images.length-1?0:e+1)},className:"absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:(0,a.jsx)(m,{className:"h-6 w-6"})})]}),r.images.length>1&&(0,a.jsx)("div",{className:"grid grid-cols-4 gap-2 mt-4",children:r.images.map((e,t)=>(0,a.jsx)("button",{onClick:()=>y(t),className:"relative aspect-square rounded-lg overflow-hidden ".concat(b===t?"ring-2 ring-blue-500":"opacity-70 hover:opacity-100"),children:(0,a.jsx)(o.default,{src:e,alt:"".concat(r.title," - Thumbnail ").concat(t+1),fill:!0,className:"object-cover"})},t))})]}):(0,a.jsx)("div",{className:"aspect-[3/4] w-full bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"No image available"})})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:r.title}),(0,a.jsxs)("p",{className:"mt-2 text-xl text-gray-600 dark:text-gray-300",children:["by ",r.author]})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:(0,a.jsxs)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Price"}),(0,a.jsxs)("dd",{className:"mt-1 text-2xl font-bold text-blue-600 dark:text-blue-400",children:["â‚¹",r.price]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Condition"}),(0,a.jsx)("dd",{className:"mt-1 text-lg text-gray-900 dark:text-white capitalize",children:r.condition})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Year of Publication"}),(0,a.jsx)("dd",{className:"mt-1 text-lg text-gray-900 dark:text-white",children:r.year_of_publication})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Location"}),(0,a.jsx)("dd",{className:"mt-1 text-lg text-gray-900 dark:text-white",children:r.location})]})]})}),(0,a.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Description"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-300 whitespace-pre-wrap",children:r.description})]}),r.seller&&(0,a.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Seller Information"}),(0,a.jsxs)("div",{className:"mt-4 flex items-center space-x-4",children:[r.seller.avatar_url?(0,a.jsx)("div",{className:"relative h-12 w-12",children:(0,a.jsx)(o.default,{src:r.seller.avatar_url,alt:r.seller.full_name||"Seller",fill:!0,className:"rounded-full object-cover"})}):(0,a.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:(r.seller.full_name||r.seller.email||"?")[0].toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.seller.full_name||"Anonymous Seller"}),r.seller.location&&(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.seller.location})]})]})]})]})]})})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,874,766,441,684,358],()=>t(934)),_N_E=e.O()}]);