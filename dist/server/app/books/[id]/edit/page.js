(()=>{var e={};e.id=44,e.ids=[44],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8834:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Coding\\\\Learner App\\\\bookmarketv2\\\\src\\\\app\\\\books\\\\[id]\\\\edit\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Coding\\Learner App\\bookmarketv2\\src\\app\\books\\[id]\\edit\\page.tsx","default")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},16189:(e,t,r)=>{"use strict";var a=r(65773);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19280:(e,t,r)=>{Promise.resolve().then(r.bind(r,8834))},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65738:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var a=r(65239),o=r(48088),i=r(88170),s=r.n(i),l=r(30893),n={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);r.d(t,n);let d={children:["",{children:["books",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8834)),"C:\\Coding\\Learner App\\bookmarketv2\\src\\app\\books\\[id]\\edit\\page.tsx"]}]},{}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"C:\\Coding\\Learner App\\bookmarketv2\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["C:\\Coding\\Learner App\\bookmarketv2\\src\\app\\books\\[id]\\edit\\page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:o.RouteKind.APP_PAGE,page:"/books/[id]/edit/page",pathname:"/books/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},70440:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var a=r(31658);let o=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},74075:e=>{"use strict";e.exports=require("zlib")},76051:(e,t,r)=>{"use strict";r.d(t,{QY:()=>i,bp:()=>o,r3:()=>s,zy:()=>l});var a=r(16391);let o=async(e,t)=>{try{let r=[];for(let o of e.images){let e=o.name.split(".").pop(),i=`${Math.random()}.${e}`,s=`${t}/${i}`,{error:l}=await a.N.storage.from("book-images").upload(s,o);if(l)throw l;let{data:{publicUrl:n}}=a.N.storage.from("book-images").getPublicUrl(s);r.push(n)}let{data:o,error:i}=await a.N.from("books").insert([{title:e.title,author:e.author,description:e.description,price:e.price,condition:e.condition,year_of_publication:e.yearOfPublication,location:e.location,category:e.category,tags:e.tags,images:r,seller_id:t,status:"available",created_at:new Date().toISOString()}]).select().single();if(i)throw i;return o}catch(e){throw console.error("Error in addBook:",e),e}},i=async e=>{console.log("Fetching book with ID:",e);try{let{data:t,error:r}=await a.N.from("books").select(`
        *,
        seller:profiles!books_seller_id_fkey (
          id,
          email,
          full_name,
          location,
          phone_number,
          avatar_url
        )
      `).eq("id",e).single();if(r)throw console.error("Supabase error:",r),r;if(!t)throw console.error("No book found with ID:",e),Error("Book not found");return console.log("Book data:",t),t}catch(e){throw console.error("Error in getBook:",e),e}},s=async(e,t)=>{console.log("Updating book with data:",t);let{images:r,existingImages:o,yearOfPublication:i,...s}=t,l={...s,year_of_publication:i};if(r&&r.length>0){let{data:{user:e}}=await a.N.auth.getUser();if(!e)throw Error("User must be authenticated to update book images");let t=[];for(let o of r){let r=o.name.split(".").pop(),i=`${Math.random()}.${r}`,s=`${e.id}/${i}`,{error:l}=await a.N.storage.from("book-images").upload(s,o);if(l)throw l;let{data:{publicUrl:n}}=a.N.storage.from("book-images").getPublicUrl(s);t.push(n)}l.images=[...o||[],...t]}let{data:n,error:d}=await a.N.from("books").update(l).eq("id",e).select().single();if(d)throw console.error("Error updating book:",d),d;return n};async function l(e){try{let t=a.N.from("books").select("*").order("created_at",{ascending:!1}),r=e?.get("q");r&&(t=t.or(`title.ilike.%${r}%,author.ilike.%${r}%,description.ilike.%${r}%`));let o=e?.get("category");o&&(t=t.eq("category",o));let{data:i,error:s}=await t;if(s)throw s;return i||[]}catch(e){throw console.error("Error fetching books:",e),e}}},77304:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(60687),o=r(43210),i=r(16189),s=r(76051);r(16391);let l=[{value:"new",label:"New"},{value:"like-new",label:"Like New"},{value:"good",label:"Good"},{value:"fair",label:"Fair"},{value:"poor",label:"Poor"}],n=[{value:"academic",label:"Academic"},{value:"fiction",label:"Fiction"},{value:"non-fiction",label:"Non-Fiction"},{value:"textbook",label:"Textbook"},{value:"reference",label:"Reference"},{value:"other",label:"Other"}];function d({params:e}){let t=(0,i.useRouter)(),[r,d]=(0,o.useState)(!0),[c,u]=(0,o.useState)(!1),[p,m]=(0,o.useState)([]),[b,g]=(0,o.useState)({title:"",author:"",description:"",price:0,condition:"new",images:[],yearOfPublication:new Date().getFullYear(),location:"",category:"other",tags:[]}),x=async r=>{r.preventDefault();try{u(!0),console.log("Updating book with data:",{...b,existingImages:p}),await (0,s.r3)(e.id,{...b,condition:b.condition,existingImages:p}),console.log("Book updated successfully"),t.push("/profile")}catch(e){console.error("Error updating book:",e),alert("Failed to update book. Please try again.")}finally{u(!1)}},h=e=>{g(t=>({...t,images:t.images.filter((t,r)=>r!==e)}))},f=e=>{m(t=>t.filter((t,r)=>r!==e))};return r?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Edit Book"}),(0,a.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),(0,a.jsx)("input",{type:"text",value:b.title,onChange:e=>g(t=>({...t,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Author"}),(0,a.jsx)("input",{type:"text",value:b.author,onChange:e=>g(t=>({...t,author:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:b.description,onChange:e=>g(t=>({...t,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:4,required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price"}),(0,a.jsx)("input",{type:"number",value:b.price,onChange:e=>g(t=>({...t,price:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"0",step:"0.01",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Condition"}),(0,a.jsx)("select",{value:b.condition,onChange:e=>g(t=>({...t,condition:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:l.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year of Publication"}),(0,a.jsx)("input",{type:"number",value:b.yearOfPublication,onChange:e=>g(t=>({...t,yearOfPublication:parseInt(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"1900",max:new Date().getFullYear(),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),(0,a.jsx)("input",{type:"text",value:b.location,onChange:e=>g(t=>({...t,location:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,a.jsx)("select",{value:b.category,onChange:e=>g(t=>({...t,category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:n.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma-separated)"}),(0,a.jsx)("input",{type:"text",value:Array.isArray(b.tags)?b.tags.join(", "):b.tags,onChange:e=>g(t=>({...t,tags:e.target.value.split(",").map(e=>e.trim())})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"e.g. mystery, thriller, fiction"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Images"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[p.map((e,t)=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:e,alt:`Book ${t+1}`,className:"w-full h-32 object-cover rounded-lg"}),(0,a.jsx)("button",{type:"button",onClick:()=>f(t),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t)),b.images.map((e,t)=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:URL.createObjectURL(e),alt:`New image ${t+1}`,className:"w-full h-32 object-cover rounded-lg"}),(0,a.jsx)("button",{type:"button",onClick:()=>h(t),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t))]}),(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{if(e.target.files){let t=Array.from(e.target.files);g(e=>({...e,images:[...e.images,...t]}))}},className:"block w-full text-sm text-gray-500   file:mr-4 file:py-2 file:px-4   file:rounded-full file:border-0   file:text-sm file:font-semibold   file:bg-blue-50 file:text-blue-700   hover:file:bg-blue-100"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>t.push("/profile"),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:c?"Saving...":"Save Changes"})]})]})]})}},77424:(e,t,r)=>{Promise.resolve().then(r.bind(r,77304))},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[447,406,658,927],()=>r(65738));module.exports=a})();